<script setup lang='ts'>
import { SignInWithOAuthCredentials } from '@supabase/gotrue-js';

const user = useSupabaseUser();
const client = useSupabaseAuthClient();

const { public: { nodeEnv } } = useRuntimeConfig();

async function login() {
  const options: SignInWithOAuthCredentials = nodeEnv === 'development' ?
    { provider: 'spotify', options: { redirectTo: 'http://localhost:3000' } }
    : { provider: 'spotify' };
  const { error } = await client.auth.signInWithOAuth(options);
  if (error) {
    return alert('Something went wrong!');
  }
}

useHead({
  title: 'Gym Albums'
});
</script>

<template>
  <header class="py-6 px-3 sm:px-7">
    <nav class="flex items-center justify-between">
      <h1 class="text-4xl font-bold">
        <a href="/" class="inline-flex gap-2 items-center">
          <svg width="36" height="36" viewBox="0 0 52 52" fill="none" xmlns="http://www.w3.org/2000/svg" class="fill-muted-800 dark:fill-muted-50 hidden sm:inline">
            <path d="M41.376 14.8053C41.5618 14.9911 41.7091 15.2117 41.8097 15.4544C41.9102 15.6971 41.962 15.9573 41.962 16.22C41.962 16.4827 41.9102 16.7429 41.8097 16.9856C41.7091 17.2283 41.5618 17.4489 41.376 17.6347C41.1902 17.8204 40.9697 17.9678 40.7269 18.0684C40.4842 18.1689 40.2241 18.2206 39.9613 18.2206C39.6986 18.2206 39.4384 18.1689 39.1957 18.0684C38.953 17.9678 38.7324 17.8204 38.5467 17.6347L34.36 13.448C34.1635 13.2649 34.0059 13.0441 33.8966 12.7988C33.7873 12.5534 33.7285 12.2886 33.7238 12.0201C33.719 11.7515 33.7684 11.4848 33.869 11.2357C33.9696 10.9867 34.1193 10.7605 34.3092 10.5706C34.4992 10.3806 34.7254 10.2309 34.9744 10.1303C35.2234 10.0297 35.4902 9.98035 35.7587 9.98509C36.0273 9.98983 36.2921 10.0486 36.5374 10.1579C36.7828 10.2672 37.0036 10.4248 37.1867 10.6213L41.3733 14.808L41.376 14.8053ZM19.048 39.96C19.4225 39.585 19.6329 39.0767 19.6329 38.5467C19.6329 38.0167 19.4225 37.5083 19.048 37.1333L14.8613 32.9467C14.6782 32.7502 14.4574 32.5926 14.2121 32.4832C13.9668 32.3739 13.7019 32.3152 13.4334 32.3104C13.1649 32.3057 12.8981 32.3551 12.6491 32.4557C12.4 32.5563 12.1738 32.706 11.9839 32.8959C11.794 33.0858 11.6443 33.312 11.5437 33.5611C11.4431 33.8101 11.3937 34.0769 11.3984 34.3454C11.4032 34.6139 11.4619 34.8788 11.5713 35.1241C11.6806 35.3694 11.8382 35.5902 12.0347 35.7733L16.2213 39.96C16.5963 40.3345 17.1047 40.5449 17.6347 40.5449C18.1647 40.5449 18.673 40.3345 19.048 39.96ZM49.832 2.22667C49.3513 1.74563 48.7805 1.36402 48.1523 1.10367C47.5241 0.843309 46.8507 0.709301 46.1707 0.709301C45.4906 0.709301 44.8172 0.843309 44.189 1.10367C43.5608 1.36402 42.99 1.74563 42.5093 2.22667L40.7227 4.01333L40.168 3.46133C39.5097 2.80285 38.7163 2.29508 37.8426 1.97309C36.9689 1.6511 36.0358 1.52256 35.1076 1.59633C34.1794 1.67011 33.2783 1.94446 32.4664 2.40042C31.6546 2.85639 30.9514 3.48312 30.4053 4.23733C28.7619 3.93131 27.0637 4.15931 25.5592 4.88798C24.0548 5.61665 22.823 6.80773 22.0442 8.28689C21.2655 9.76606 20.9806 11.4556 21.2312 13.1084C21.4819 14.7611 22.255 16.2903 23.4373 17.472L25.3493 19.384L19.3787 25.3573L17.4667 23.4427C16.2849 22.2603 14.7558 21.4872 13.1031 21.2366C11.4503 20.9859 9.76072 21.2708 8.28156 22.0496C6.80239 22.8283 5.61132 24.0601 4.88265 25.5646C4.15398 27.0691 3.92597 28.7673 4.232 30.4107C3.47778 30.9567 2.85106 31.6599 2.39509 32.4718C1.93912 33.2836 1.66478 34.1847 1.591 35.1129C1.51722 36.0411 1.64577 36.9743 1.96776 37.8479C2.28975 38.7216 2.79751 39.515 3.456 40.1733L4.008 40.728L2.16267 42.5733C1.19197 43.544 0.646645 44.8606 0.646645 46.2333C0.646645 47.6061 1.19197 48.9226 2.16267 49.8933C3.13336 50.864 4.4499 51.4094 5.82267 51.4094C7.19543 51.4094 8.51197 50.864 9.48267 49.8933L11.328 48.048L11.8827 48.6C12.541 49.258 13.3342 49.7654 14.2076 50.0871C15.081 50.4088 16.0138 50.5372 16.9417 50.4634C17.8695 50.3897 18.7703 50.1155 19.5819 49.6598C20.3935 49.2041 21.0966 48.5778 21.6427 47.824C23.2861 48.13 24.9843 47.902 26.4888 47.1734C27.9932 46.4447 29.225 45.2536 30.0038 43.7744C30.7825 42.2953 31.0674 40.6057 30.8168 38.9529C30.5661 37.3002 29.793 35.7711 28.6107 34.5893L26.6987 32.6773L32.672 26.704L34.584 28.6187C35.7657 29.801 37.2949 30.5741 38.9476 30.8248C40.6003 31.0754 42.2899 30.7905 43.7691 30.0118C45.2483 29.233 46.4393 28.0012 47.168 26.4968C47.8967 24.9923 48.1247 23.2941 47.8187 21.6507C48.5729 21.1046 49.1996 20.4014 49.6556 19.5896C50.1115 18.7777 50.3859 17.8766 50.4597 16.9484C50.5334 16.0202 50.4049 15.0871 50.0829 14.2134C49.7609 13.3397 49.2532 12.5463 48.5947 11.888L48.0427 11.3333L49.8293 9.54667C50.3104 9.06598 50.692 8.49521 50.9523 7.86698C51.2127 7.23875 51.3467 6.56537 51.3467 5.88533C51.3467 5.20529 51.2127 4.53191 50.9523 3.90368C50.692 3.27545 50.3104 2.70468 49.8293 2.224L49.832 2.22667ZM45.2133 8.50667L43.5493 6.84267L45.3387 5.05333C45.5593 4.83267 45.8586 4.70871 46.1707 4.70871C46.4827 4.70871 46.782 4.83267 47.0027 5.05333C47.2233 5.27399 47.3473 5.57327 47.3473 5.88533C47.3473 6.19739 47.2233 6.49667 47.0027 6.71733L45.216 8.504L45.2133 8.50667ZM29.8427 23.8773L23.8693 29.8507L22.208 28.184L28.1787 22.2133L29.8427 23.8773ZM8.50133 45.2187L6.65333 47.064C6.43132 47.2763 6.13506 47.3933 5.82791 47.3899C5.52076 47.3866 5.2271 47.2633 5.00973 47.0462C4.79235 46.8292 4.66852 46.5358 4.66471 46.2286C4.6609 45.9215 4.77741 45.625 4.98933 45.4027L6.83733 43.5547L8.50133 45.2187ZM33.8933 6.288C34.1195 6.06159 34.388 5.88198 34.6836 5.75943C34.9792 5.63688 35.296 5.5738 35.616 5.5738C35.936 5.5738 36.2528 5.63688 36.5484 5.75943C36.844 5.88198 37.1125 6.06159 37.3387 6.288L45.7653 14.7147C46.06 15.009 46.2743 15.3739 46.3876 15.7747C46.501 16.1754 46.5097 16.5985 46.4128 17.0036C46.316 17.4086 46.1169 17.782 45.8345 18.0882C45.5521 18.3943 45.1959 18.6228 44.8 18.752C44.532 18.8392 44.2854 18.9821 44.0765 19.1713C43.8675 19.3605 43.701 19.5917 43.5877 19.8498C43.4744 20.1079 43.4169 20.387 43.419 20.6689C43.4211 20.9508 43.4828 21.229 43.6 21.4853C43.9725 22.302 44.0465 23.2236 43.8091 24.0893C43.5716 24.955 43.0378 25.7098 42.3007 26.2222C41.5636 26.7345 40.6701 26.9719 39.7759 26.8927C38.8817 26.8136 38.0437 26.4231 37.408 25.7893L26.2613 14.6427C25.6246 14.0077 25.2316 13.1688 25.1513 12.2732C25.0709 11.3775 25.3084 10.4821 25.822 9.74398C26.3356 9.00583 27.0927 8.47199 27.9604 8.236C28.8282 8.00002 29.7513 8.07696 30.568 8.45333C30.8244 8.57052 31.1026 8.6322 31.3844 8.63433C31.6663 8.63645 31.9454 8.57898 32.2035 8.46567C32.4616 8.35236 32.6928 8.18578 32.882 7.97685C33.0712 7.76792 33.2141 7.52136 33.3013 7.25333C33.4194 6.8892 33.6223 6.55833 33.8933 6.288ZM9.21867 26.272C9.57426 25.9163 9.99644 25.6342 10.4611 25.4417C10.9257 25.2492 11.4237 25.1502 11.9267 25.1502C12.4296 25.1502 12.9276 25.2492 13.3923 25.4417C13.8569 25.6342 14.2791 25.9163 14.6347 26.272L25.7813 37.4187C26.417 38.0537 26.8092 38.892 26.8892 39.7869C26.9692 40.6819 26.732 41.5765 26.219 42.3142C25.706 43.0518 24.95 43.5857 24.0831 43.8222C23.2163 44.0587 22.2939 43.9829 21.4773 43.608C21.221 43.4908 20.9428 43.4291 20.6609 43.427C20.379 43.4249 20.0999 43.4824 19.8418 43.5957C19.5837 43.709 19.3525 43.8755 19.1633 44.0845C18.9741 44.2934 18.8312 44.54 18.744 44.808C18.6145 45.2037 18.3857 45.5596 18.0795 45.8417C17.7732 46.1238 17.3997 46.3226 16.9947 46.4192C16.5897 46.5158 16.1667 46.5068 15.7661 46.3933C15.3655 46.2798 15.0008 46.0654 14.7067 45.7707L6.28 37.344C5.98596 37.0497 5.77225 36.6849 5.65926 36.2845C5.54628 35.8841 5.53778 35.4614 5.63459 35.0568C5.7314 34.6521 5.93029 34.2791 6.21227 33.9732C6.49425 33.6673 6.84992 33.4387 7.24533 33.3093C7.51336 33.2221 7.75992 33.0792 7.96885 32.89C8.17778 32.7008 8.34436 32.4696 8.45767 32.2115C8.57098 31.9534 8.62845 31.6743 8.62633 31.3924C8.6242 31.1106 8.56252 30.8323 8.44533 30.576C8.1199 29.8653 8.01957 29.0722 8.1578 28.3029C8.29602 27.5336 8.6662 26.8249 9.21867 26.272Z" />
          </svg>
          <span class="">
            Gym Albums
          </span>
        </a>
      </h1>
      <ul class="flex flex-col sm:flex-row items-end gap-4 whitespace-nowrap">
        <li>
          <button @click="navigateTo('/submit')" :disabled="!user" class="bg-muted-200 dark:bg-muted-600 px-4 py-1 rounded-md">
            Submit Album
          </button>
        </li>
        <li>
          <button v-if="user" @click="client.auth.signOut()" class="bg-muted-200 dark:bg-muted-600 px-4 py-1 rounded-md">
            Log Out
          </button>
          <button v-else @click="login" class="bg-muted-200 dark:bg-muted-600 px-4 py-1 rounded-md">
            Log In
          </button>
        </li>
      </ul>
    </nav>
  </header>
  <slot />
  <footer class="py-4 px-6 mt-8">
    <p class="text-sm">&copy; 2023 Gym Albums. All rights reserved.</p>
  </footer>
</template>